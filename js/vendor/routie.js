(function(f){var g=[],h={},n=f.routie,j=function(c,b){this.name=b;this.path=c;this.keys=[];this.fns=[];this.params={};var a;a=this.path;var e=this.keys;a instanceof RegExp||(a instanceof Array&&(a="("+a.join("|")+")"),a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,b,c,d,f,g){e.push({name:d,optional:!!g});b=b||"";return""+(g?"":b)+"(?:"+(g?b:"")+(c||"")+(f||c&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,
"(.+)").replace(/\*/g,"(.*)"),a=RegExp("^"+a+"$","i"));this.regex=a};j.prototype.addHandler=function(c){this.fns.push(c)};j.prototype.removeHandler=function(c){for(var b=0,a=this.fns.length;b<a;b++)if(c==this.fns[b]){this.fns.splice(b,1);break}};j.prototype.run=function(c){for(var b=0,a=this.fns.length;b<a;b++)this.fns[b].apply(this,c)};j.prototype.match=function(c,b){var a=this.regex.exec(c);if(!a)return!1;for(var e=1,d=a.length;e<d;++e){var f=this.keys[e-1],g="string"==typeof a[e]?decodeURIComponent(a[e]):
a[e];f&&(this.params[f.name]=g);b.push(g)}return!0};j.prototype.toURL=function(c){var b=this.path,a;for(a in c)b=b.replace("/:"+a,"/"+c[a]);b=b.replace(/\/:.*\?/g,"/").replace(/\?/g,"");if(-1!=b.indexOf(":"))throw Error("missing parameters for url: "+b);return b};var l=function(c,b){var a=c.split(" "),e=2==a.length?a[0]:null;c=2==a.length?a[1]:a[0];h[c]||(h[c]=new j(c,e),g.push(h[c]));h[c].addHandler(b)},d=function(c,b){if("function"==typeof b)l(c,b),d.reload();else if("object"==typeof c){for(var a in c)l(a,
c[a]);d.reload()}else"undefined"===typeof b&&d.navigate(c)};d.lookup=function(c,b){for(var a=0,e=g.length;a<e;a++){var d=g[a];if(d.name==c)return d.toURL(b)}};d.remove=function(c,b){var a=h[c];a&&a.removeHandler(b)};d.removeAll=function(){h={};g=[]};d.navigate=function(c,b){b=b||{};var a=b.silent||!1;a&&(f.removeEventListener?f.removeEventListener("hashchange",k):f.detachEvent("onhashchange",k));setTimeout(function(){window.location.hash=c;a&&setTimeout(function(){m()},1)},1)};d.noConflict=function(){f.routie=
n;return d};var k=d.reload=function(){for(var c=window.location.hash.substring(1),b=0,a=g.length;b<a;b++){var e;e=g[b];var d=[];e.match(c,d)?(e.run(d),e=!0):e=!1;if(e)break}},m=function(){f.addEventListener?f.addEventListener("hashchange",k,!1):f.attachEvent("onhashchange",k)};m();f.routie=d})(window);
