Sydney["list-nav"]=function(){function x(b,d){var c={levels:{1:{css_class:"level-1-list-item",active:!0,allow_multiple_actives:!0,expandable:!0,click_callback:null,removable:!1,remove_callback:null,children_placeholder_title:null,children_placeholder_class:null},2:{css_class:"level-2-list-item",active:!1,allow_multiple_actives:!0,expandable:!0,click_callback:null,removable:!1,remove_callback:null,children_placeholder_title:null,children_placeholder_class:null},3:{css_class:"level-3-list-item",active:!1,
allow_multiple_actives:!0,expandable:!1,click_callback:null,removable:!1,remove_callback:null,children_placeholder_title:null,children_placeholder_class:null}}};$.extend(!0,c,d);b.data(k+"settings",c);b.data(k+"preserved-active-items",[]);b.data(k+"preserved-to-be-deleted-items",[])}function y(b,d,c,e,g,f){var h,j,m,l,r,q=n(b),p;l=b.data(k+g);if(_.isArray(l)){$.each(q.levels,function(d,f){f[c]&&(h=z(b,d),h.each(function(b,c){j=$(c);m=$(this).data();r=!1;for(p=0;p<l.length;p++)preservedStatusItem=
l[p],_.isEqual(m,preservedStatusItem.props)&&(r=!0,preservedStatusItem.status=j.hasClass(e));!r&&!_.isEmpty(m)&&l.push({props:m,status:j.hasClass(e),level:d})}))});b.data(k+g,l);for(p=0;p<l.length;p++)preservedStatusItem=l[p],_.isFunction(f)&&f(d,preservedStatusItem.status,preservedStatusItem.level,preservedStatusItem.props)}else l=[],b.data(k+g,l)}function E(b){var d=$(b.delegateTarget);b=$(this).parent();var c=b.parentsUntil(d).length/2+1,e=b.data(),g=n(d),f=g.levels[c].click_callback,h=g.levels[c].expandable,
j=b.hasClass("show-more-list-item"),m=b.hasClass("show-less-list-item"),l=d.data(k+"edit-mode-active");!l&&_.isFunction(f)&&f(e);h?($childItemsEl=b.children(".expanded-list-items"),$childItemsEl.length&&(b.toggleClass("active"),Sydney.settings.getAnimationsEnabled()&&Sydney.globals.heavyAnimationsEnabled?($childItemsEl.finish(),$childItemsEl.hasClass("list-hidden")?(b.addClass("active"),$childItemsEl.removeClass("list-hidden"),e=$childItemsEl.css("height","auto").height(),$childItemsEl.height(0),
$childItemsEl.animate({height:e},300,"swing",function(){$childItemsEl.css("height","")})):(b.removeClass("active"),$childItemsEl.animate({height:0},300,"swing",function(){$childItemsEl.addClass("list-hidden");$childItemsEl.css("height","")}))):$childItemsEl.toggleClass("list-hidden"))):l&&A(d,b);if(j)b.addClass("hidden"),b.nextAll().removeClass("hidden"),b.parent().append(u(q(d,{title:g.levels[c].show_less_button_title},c,!1,"show-less-list-item"))),b.remove();else if(m){var r=0,s=g.levels[c].show_more_min_article_count,
m=b.parent().parent(),j=m.offsetParent();console.log(m,j);b.parent().children().each(function(){r+1>=s-1&&$(this).addClass("hidden");r+1===s-1&&$(this).before(u(q(d,{title:g.levels[c].show_more_button_title},c,!1,"show-more-list-item")));r++});b.remove();b=m.position().top;console.log("listitemin distanssi: ",b);0>b&&j.scrollTop(j.scrollTop()+b)}}function A(b,d){var c=d.parent().parent(),e=c.find(".children-delete-button");d.toggleClass("to-be-deleted");c=c.find(".to-be-deleted").length;0<c?(e.html(t("listnav.delete_children_text",
{deletecount:c})),e.removeClass("hidden")):e.addClass("hidden")}function F(b){var d=$(b.delegateTarget);$(this);var c=$(this).parent().parent(),e=c.find(".to-be-deleted"),g,c=c.parentsUntil(d).length/2+2,f=n(d).levels[c].remove_callback,h;e.each(function(){g=$(this);_.isFunction(f)&&(h=g.data(),f(h))});b.stopPropagation()}function B(b,d,c,e){$itemsEl=d.children(".expanded-list-items");if(!$itemsEl.length)return!1;level=d.parentsUntil(b).length/2+2;tplData=q(b,c,level);html=u(tplData);$itemsEl.hasClass("placeholder")&&
($itemsEl.removeClass("placeholder"),$itemsEl.html(""));if("append"===e)$itemsEl.append(html);else if("prepend"===e)$itemsEl.prepend(html);else if("alphabet"===e){var g=null;$itemsEl.find(".list-item-button").each(function(){var b=$(this);if(b.html()<c.title)g=b;else return!1});null!==g?g.parent().after(html):$itemsEl.prepend(html)}}function s(b,d,c,e){c&&(c&&!e?(c=b.data(k+"last-active-items"),e=d.parentsUntil(b).length/2+1,_.isObject(c)?(!_.isUndefined(c[e])&&c[e][0]!==d[0]&&(c[e].removeClass("active"),
c[e].children(".expanded-list-items").addClass("list-hidden")),c[e]=d):(c={},c[e]=d,b.data(k+"last-active-items",c))):c&&"one-per-parent"===e&&d.parent().children().each(function(){var b=$(this);b.hasClass("active")&&(b.removeClass("active"),b.children(".expanded-list-items").addClass("list-hidden"))}),d.addClass("active"),d.children(".expanded-list-items").removeClass("list-hidden"))}function v(b,d){var c=!1;$.each(d,function(d,g){c=!1===c?b.find(".list-item[data-"+d+'="'+g+'"]'):c.filter("[data-"+
d+'="'+g+'"]')});return c}function u(b){return Sydney.templates.renderTpl("list-nav","list-nav-item",b)}function w(b,d,c){c=_.isUndefined(c)?1:c;var e,g=C(b,c),f=[],h=n(b);if(!0===h.levels[c].show_more_enabled&&d.length>=h.levels[c].show_more_min_article_count){var j=h.levels[c].show_more_min_article_count;for(e=0;e<d.length;e++)e+1>=j-1&&(d[e].hidden=!0),e+1===j-1&&f.push(q(b,{title:h.levels[c].show_more_button_title},c,!1,"show-more-list-item")),f.push(q(b,d[e],c,g)),_.isArray(d[e].children)&&(f[e].children=
w(b,d[e].children,c+1))}else for(e=0;e<d.length;e++)f.push(q(b,d[e],c,g)),_.isArray(d[e].children)&&(f[e].children=w(b,d[e].children,c+1));return f}function q(b,d,c,e,g){var f={},h=n(b),j=h.levels[c].css_class,m=["title","sidetext","children","hidden"];f["class"]="";_.isString(j)&&(f["class"]+=j);_.isString(g)&&(f["class"]+=" "+g);f.isActive=_.isUndefined(e)?C(b,c):e;!_.isUndefined(d.hidden)&&!0===d.hidden&&(f.isHidden=!0);h.levels[c].removable&&(f.Removable=!0);!_.isUndefined(h.levels[c+1])&&h.levels[c+
1].removable&&(f.childrenAreRemovable=!0);_.isString(h.levels[c].children_placeholder_title)&&(b=h.levels[c].children_placeholder_class,f.placeholder={title:h.levels[c].children_placeholder_title,"class":b?b:j});f.title=d.title;_.isUndefined(d.sidetext)||(f.sidetext=d.sidetext);f.props={};$.each(d,function(b,c){-1===_.indexOf(m,b)&&(f.props[b]=c)});return f}function D(b,d,c,e,g){var f,h,j;c=parseInt(c,10);g=_.isUndefined(g)?1:g;for(f=0;f<b.length;f++){if(g===c&&(h=!0,$.each(e,function(c,d){b[f].props[c]=
_.isNumber(b[f].props[c])?b[f].props[c].toString():b[f].props[c];d=_.isNumber(d)?d.toString():d;b[f].props[c]!==d&&(h=!1)}),h))return b[f].isActive=d,!0;if(g<c&&_.isArray(b[f].children)&&(j=D(b[f].children,d,c,e,g+1)))return!0}return!1}function C(b,d){var c=n(b).levels[d].active;return!_.isUndefined(c)?c:!1}function n(b){return b.data(k+"settings")}function z(b,d){$listItemEls=b.children();if(1<d)for(a=0;a<d-1;a++)$listItemEls=$listItemEls.children().children();return $listItemEls}var G=[],k="sydney-list-nav-";
return{init:function(){Sydney.templates.registerPartialTpl("list-nav","list-nav-item")},createList:function(b,d){x(b,d);G.push(b);b.on("click",".list-item-button",E);b.on("click",".children-delete-button",F)},setNewSettings:x,renderAndShowList:function(b,d){var c=w(b,d),e="",g;y(b,c,"preserve_actives","active","preserved-active-items",D);y(b,c,"removable","to-be-deleted","preserved-to-be-deleted-items",null);for(g=0;g<c.length;g++)e+=u(c[g]);b.html(e);var c=b.data(k+"preserved-to-be-deleted-items"),
f;$.each(c,function(c,d){!1!==d.status&&(f=".list-item",$.each(d.props,function(b,c){"id"===b&&(f+="[data-"+b+'="'+c+'"]')}),A(b,b.find(f)))})},addItemToList:function(b,d,c,e){n(b);$listItemEl=v(b,d);if(!1===$listItemEl&&$listItemEl.length)return!1;B(b,$listItemEl,c,e)},removeItemFromList:function(b,d){$filteredListItemEl=v(b,d);if(!1!==$filteredListItemEl&&$filteredListItemEl.length){var c=$filteredListItemEl,e=c.parent();if(1===e.children().length){var g=e.parent(),f=g.parentsUntil(b).length/2+
1,h=n(b);B(b,g,{"class":h.levels[f].children_placeholder_class,title:h.levels[f].children_placeholder_title},"prepend");e.addClass("placeholder")}c.remove()}},setListItemActive:function(b,d,c,e,g){var f=null,h=n(b),f=v(b,d);!1!==f&&f.length&&(d=f.parentsUntil(b).length/2+1,s(b,f,c,h.levels[d].allow_multiple_actives),e&&f.parentsUntil(b,".list-item").each(function(){s(b,$(this),!0,!0)}),g&&(c=f.offsetParent(),e=f.position().top,f=f.outerHeight(),g=c.height(),0>e?c.scrollTop(c.scrollTop()+e):e+f>g&&
c.scrollTop(c.scrollTop()+e-g+f)))},setListItemsOfLevelActive:function(b,d,c){z(b,d).each(function(){s(b,$(this),c,!0)})},setPreviousActiveItemNotActive:function(b,d){var c=b.data(k+"last-active-items");_.isObject(c)&&!_.isUndefined(c[d])&&(c[d].removeClass("active"),c[d].children(".expanded-list-items").addClass("list-hidden"),c[d]=void 0)},enableEditMode:function(b){b.addClass("edit-active")},disableEditMode:function(b){b.removeClass("edit-active")},toggleEditMode:function(b){var d=b.data(k+"edit-mode-active");
!_.isUndefined(d)&&d?(b.removeClass("edit-active"),b.data(k+"edit-mode-active",!1)):(b.addClass("edit-active"),b.data(k+"edit-mode-active",!0))}}}();
