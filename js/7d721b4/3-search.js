Sydney.search=function(){function p(e){b&&(Sydney["list-nav"].setPreviousActiveItemNotActive(g,3),Sydney["list-nav"].setListItemActive(g,{id:e},!0,!1,!1))}function u(){a.val()===t("search.placeholder")?(a.removeClass("placeholder-active"),a.val("")):b||q()}function q(){var e=$(this).val(),a;if(""===e&&b)Sydney.sidebars.restorePreviousLeftSidebarTab(),k.hide(),l.show(),b=!1;else{if(""===e&&!b)return;b||(Sydney.sidebars.clearActiveTabs(),l.hide(),k.show(),b=!0)}a=Sydney.data.getSearchResults(e);var f=
[],h=[],j=[],r=[],d=[];$.each(a,function(a,c){"document"===c.type?j.push({id:c.id,order:n(Sydney.data.getItemMenuTitle(c.id).toLowerCase(),e.toLowerCase()),title:Sydney.data.getItemMenuTitle(c.id)}):"body"===c.type?r.push({id:c.id,order:n(Sydney.data.getItemMenuTitle(c.id),e)}):"category"===c.type&&f.push({id:c.id,order:n(Sydney.data.getItemMenuTitle(c.id),e)})});a=function(a,c){return a.order>c.order?1:a.order<c.order?-1:0};j.sort(a);f.sort(a);$.each(f,function(a,c){$.each(Sydney.data.getMenuItemChildrenItems(c.id),
function(a,c){"document"==c.type&&h.push({id:c.id})})});$.each(j,function(a,c){d.push(c.id)});$.each(r,function(a,c){-1===_.indexOf(d,c.id)&&d.push(c.id)});$.each(h,function(a,c){-1===_.indexOf(d,c.id)&&d.push(c.id)});console.log(d);a=!0;if(null!==m&&m.length===d.length)for(i=0;i<d.length;i++)d[i]!==m[i]&&(a=!1);else a=!1;a||(s(d),p(Sydney.article.getActiveArticleId()));m=d}function v(){""===$(this).val()&&(a.addClass("placeholder-active"),a.val(t("search.placeholder")))}function w(a){a.id&&Sydney.article.openArticleById(a.id,
!0,!1)}function s(a){var b=[{title:"Hakutulokset",id:1,children:[]}];a.length&&(b[0].children=Sydney.bookmarks.getListItemsGroupedByRootCats(a,!1,!0));Sydney["list-nav"].renderAndShowList(g,b)}function n(a,b){var f=null;$.each(b.split(" "),function(b,j){b=a.indexOf(j);if(-1!==a.indexOf(j)&&(null===f||f>b))f=b});return null!==f?f:100}var a,k,g,l,b=!1,m=null;return{init:function(){a=$("#search-field");k=$("#search-results");g=$("#search-results-list");l=$("#left-sidebar-tabs-content");a.val(t("search.placeholder"));
Sydney.events.on("article","afterArticleOpen",function(b,g){p(g);var f=a.val();if(f){var h=$("#article");h.unmark({done:function(){h.mark(f,{element:"span",className:"search-term-match",accuracy:"partially",caseSensitive:!1,separateWordSearch:!1,acrossElements:!0,exclude:[".MathJax .math *"],diacritics:!1,done:function(){h.find('svg[aria-labelledby="MathJax-SVG-1-Title"]').each(function(){-1!==$(this).children("#MathJax-SVG-1-Title").text().indexOf(f)&&$(this).wrap('<span data-markjs="true" class="search-term-match"></span>')});
var a=h.find(".search-term-match");if(a.length){var b=a[0],d=$(b).offset().top-175,b=$(b).closest("table").children("thead");b.length&&(b=b[0],b=$(b).outerHeight(),d=35<b?d-(b+8):d-44);$("#article-content").scrollTop(d);var e=!1;a.each(function(){var a=$(this).parent();if(e){if(a.is(e))return}else e=a;if("TD"===a.prop("tagName")){var b=a.parent();b.hasClass("highlight")||(b.addClass("highlight"),0!==b.index()&&(b=b.prev(),!b.hasClass("highlight")&&!b.hasClass("row-before-highlight")&&b.addClass("row-before-highlight")))}e=
a})}}})}})}});a.on("click",function(){Sydney["platform-android"].getIsAndroid()&&a.focus()});a.on("focus",u);a.on("keyup",q);a.on("blur",v);if(Sydney.globals.scrollingIsPolyfilled)a.on("touchstart",function(a){a.preventDefault()})},start:function(){Sydney["list-nav"].createList(g,{levels:{1:{css_class:"header-list-item",active:!0,allow_multiple_actives:!0,expandable:!0,children_placeholder_title:t("search.no_results_text"),children_placeholder_class:"article-list-item",preserve_actives:!0},2:{css_class:"topic-list-item",
active:!0,allow_multiple_actives:!0,expandable:!0,preserve_actives:!0},3:{css_class:"article-list-item",active:!1,allow_multiple_actives:!1,expandable:!1,click_callback:w,show_more_enabled:!0,show_more_min_article_count:5,show_more_button_title:t("search.show_all_results_text"),show_less_button_title:t("search.show_less_results_text")}}});s([])},exitSearchIfIsOpen:function(){b&&(k.hide(),l.show(),b=!1,a.addClass("placeholder-active"),a.val(t("search.placeholder")),a.blur())}}}();
